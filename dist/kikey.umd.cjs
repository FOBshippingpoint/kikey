(function(a,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(a=typeof globalThis<"u"?globalThis:a||self,h(a.kikey={}))})(this,function(a){"use strict";const h=new Set(["space","dash","arrowleft","arrowright","arrowup","arrowdown","backspace","enter","escape","capslock","tab","home","pageup","pagedown","end","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12"]);function L(n){let l=!1,c=!1,y=!1,r=!1,s;for(const t of n.split("-"))if(t.length==1)l=t=="C"||l,c=t=="S"||c,y=t=="A"||y,r=t=="M"||r,s=t;else if(h.has(t))s=t=="space"?" ":t=="dash"?"-":t;else throw Error("Invalid binding.");return n.length==1&&(l?s="control":c?s="shift":y?s="alt":r&&(s="meta")),{ctrlKey:l,shiftKey:c,altKey:y,metaKey:r,key:s}}function C(n){if(!document)throw Error("Only support browser environment.");n||(n=document);const l=new Map;let c,y,r=!0;function s(e){return["control","shift","alt","meta"].includes(e.toLowerCase())}function t(e){if(r){if(e.type=="keyup"&&!s(e.key))c=e.key.toLowerCase();else if(e.type=="keydown"){const{ctrlKey:d,shiftKey:u,altKey:p,metaKey:f}=e,o=e.key.toLowerCase();for(const[i,k]of l.entries()){const{onComboChange:g,combo:w,bindings:v}=k,K=v[w];K.ctrlKey==d&&K.shiftKey==u&&K.altKey==p&&K.metaKey==f&&K.key==o&&(w==0||v[w-1].key==c||v[w-1].key==y)?(k.combo++,g instanceof Function&&g(k.combo),k.combo==v.length&&(i(),k.combo=0)):(g(w),k.combo=0)}s(e.key)&&(y=e.key)}}}n.addEventListener("keydown",t),n.addEventListener("keyup",t);let b=[];const m=e=>b.push(e);return{on(e,d=()=>{},u=()=>{}){const p=e.split(" ").filter(f=>f!=="").map(L);l.set(d,{bindings:p,combo:0,onComboChange:u})},off(e){l.delete(e)},enable(){r=!0},disable(){r=!1},startRecord(){n.addEventListener("keydown",m),n.addEventListener("keyup",m)},stopRecord(){var p;n.removeEventListener("keydown",m),n.removeEventListener("keyup",m);const e=[];let d=0,u=1;for(;d<b.length;){const f=b[d];if(f.type=="keydown"&&((p=b.at(u))==null?void 0:p.type)=="keyup"){let o=f.ctrlKey?"C":"";o+=f.shiftKey?"S":"",o+=f.altKey?"A":"",o+=f.metaKey?"M":"",o=o.split("").join("-");let i=f.key.toLowerCase();i==" "?i="space":i=="-"?i="dash":s(i)&&(i=null),o.length>0&&i?o+="-"+i:o.length==0&&(o=i),e.push(o)}d++,u++}return b=[],e.join(" ")}}}a.default=C,a.makeBinding=L,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
