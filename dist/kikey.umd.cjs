(function(h,k){typeof exports=="object"&&typeof module<"u"?module.exports=k():typeof define=="function"&&define.amd?define(k):(h=typeof globalThis<"u"?globalThis:h||self,h.kikey=k())})(this,function(){"use strict";const h=new Set(["space","dash","arrowleft","arrowright","arrowup","arrowdown","backspace","enter","escape","capslock","tab","home","pageup","pagedown","end","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12"]);function k(n){let r=!1,y=!1,c=!1,l=!1,s="";for(const t of n.split("-"))if(t.length==1)r=t=="C"||r,y=t=="S"||y,c=t=="A"||c,l=t=="M"||l,s=t;else if(h.has(t))s=t=="space"?" ":t=="dash"?"-":t;else throw Error("Invalid binding.");return n.length==1&&(r?s="control":y?s="shift":c?s="alt":l&&(s="meta")),{ctrlKey:r,shiftKey:y,altKey:c,metaKey:l,key:s}}function C(n){if(typeof document>"u")throw Error("Only support browser environment.");n||(n=document);const r=new Map;let y="",c="",l=!0;function s(e){return["control","shift","alt","meta"].includes(e.toLowerCase())}function t(e){if(l){if(e.type=="keyup"&&!s(e.key))y=e.key.toLowerCase();else if(e.type=="keydown"){const{ctrlKey:a,shiftKey:d,altKey:p,metaKey:f}=e,o=e.key.toLowerCase();for(const[i,u]of r.entries()){const{onComboChange:L,combo:K,bindings:v}=u,b=v[K];b.ctrlKey==a&&b.shiftKey==d&&b.altKey==p&&b.metaKey==f&&b.key==o&&(K==0||v[K-1].key==y||v[K-1].key==c)?(u.combo++,L instanceof Function&&L(u.combo),u.combo==v.length&&(i(),u.combo=0)):(L(K),u.combo=0)}s(e.key)&&(c=e.key)}}}n.addEventListener("keydown",t),n.addEventListener("keyup",t);let w=[];const m=e=>{w.push(e)};return{on(e,a=()=>{},d=()=>{}){const p=e.split(" ").filter(f=>f!=="").map(k);r.set(a,{bindings:p,combo:0,onComboChange:d})},off(e){r.delete(e)},enable(){l=!0},disable(){l=!1},startRecord(){n.addEventListener("keydown",m),n.addEventListener("keyup",m)},stopRecord(){var p;n.removeEventListener("keydown",m),n.removeEventListener("keyup",m);const e=[];let a=0,d=1;for(;a<w.length;){const f=w[a];if(f.type=="keydown"&&((p=w.at(d))==null?void 0:p.type)=="keyup"){let o=f.ctrlKey?"C":"";o+=f.shiftKey?"S":"",o+=f.altKey?"A":"",o+=f.metaKey?"M":"",o=o.split("").join("-");let i=f.key.toLowerCase();i==" "?i="space":i=="-"?i="dash":s(i)&&(i=""),o.length>0&&i?o+="-"+i:o.length==0&&(o=i),e.push(o)}a++,d++}return w=[],e.join(" ")}}}return C});
